<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentinel Log Strategy Planner | LockBase Inspired</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .bg-slate-950 { background-color: #020617; }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; margin: 0; 
        }
        .step-hidden { display: none; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-slate-950/80 backdrop-blur-md border-b border-slate-800 px-6 py-4">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row md:items-center justify-between gap-6">
            <div class="flex items-center gap-4">
                <div class="bg-blue-600 p-2 rounded-xl shadow-lg shadow-blue-600/20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight">Sentinel Log Planner</h1>
                    <p class="text-xs text-slate-500 font-medium uppercase tracking-widest">Enterprise Strategy Tool</p>
                </div>
            </div>

            <!-- Navigation -->
            <div class="flex flex-wrap items-center gap-3">
                <button onclick="switchStep(0)" id="nav-0" class="nav-btn flex items-center gap-2 px-4 py-2 rounded-lg transition-all border bg-blue-600 text-white border-blue-500 shadow-lg shadow-blue-500/20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                    <span class="font-medium">Setup</span>
                </button>
                <button onclick="switchStep(1)" id="nav-1" class="nav-btn flex items-center gap-2 px-4 py-2 rounded-lg transition-all border bg-slate-800 text-slate-400 border-slate-700 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z"/><path d="m3 9 2.45-4.91A2 2 0 0 1 7.24 3h9.52a2 2 0 0 1 1.8 1.09L21 9"/></svg>
                    <span class="font-medium">Sources</span>
                    <span id="source-count-badge" class="text-[10px] bg-blue-500/20 text-blue-300 px-1.5 rounded-full ml-1">4</span>
                </button>
                <button onclick="switchStep(2)" id="nav-2" class="nav-btn flex items-center gap-2 px-4 py-2 rounded-lg transition-all border bg-slate-800 text-slate-400 border-slate-700 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                    <span class="font-medium">Costs</span>
                </button>
            </div>

            <!-- Stats -->
            <div class="hidden lg:flex items-center gap-6 border-l border-slate-800 pl-6">
                <div class="text-right">
                    <div class="text-[10px] text-slate-500 uppercase font-bold tracking-tighter">Daily Ingestion</div>
                    <div id="stat-daily" class="text-lg font-mono font-bold text-blue-400">0.00 <span class="text-xs text-slate-600">GB</span></div>
                </div>
                <div class="text-right">
                    <div class="text-[10px] text-slate-500 uppercase font-bold tracking-tighter">Est. Monthly</div>
                    <div id="stat-cost" class="text-lg font-mono font-bold text-emerald-400">$0</div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6 md:p-8">
        
        <!-- STEP 0: SETUP -->
        <div id="step-0" class="step-content space-y-8 animate-fade-in">
            <section class="bg-slate-900/50 border border-slate-800 rounded-3xl p-8">
                <div class="flex items-center gap-3 mb-8">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><circle cx="12" cy="12" r="10"/><path d="m16.2 7.8-2 2"/><path d="M12 12s.01 0 0 0"/><path d="M4.5 16.5 6 15"/><path d="m15 15 4.5 4.5"/><path d="m21 12-2-2"/><path d="M5.9 5.9 9 9"/></svg>
                    <h2 class="text-xl font-bold">Environment Configuration</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="space-y-6">
                        <div>
                            <label class="text-sm font-semibold text-slate-400 mb-2 block">Number of Users</label>
                            <input type="number" id="input-users" value="250" oninput="updateState('users', this.value)" class="w-full bg-slate-800 border border-slate-700 rounded-xl py-2.5 px-4 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="text-sm font-semibold text-slate-400 mb-2 block">Endpoints</label>
                            <input type="number" id="input-endpoints" value="250" oninput="updateState('endpoints', this.value)" class="w-full bg-slate-800 border border-slate-700 rounded-xl py-2.5 px-4 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                    </div>

                    <div class="space-y-4">
                        <label class="text-sm font-semibold text-slate-400 block">Target Azure Region</label>
                        <div id="region-selector" class="grid grid-cols-1 gap-2">
                            <!-- JS will inject regions -->
                        </div>
                    </div>

                    <div id="e5-card" class="p-6 rounded-3xl border transition-all bg-indigo-600/10 border-indigo-500/50">
                        <div class="flex items-center justify-between mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>
                            <button onclick="toggleE5()" id="e5-toggle" class="w-12 h-6 rounded-full relative transition-all bg-indigo-500">
                                <div id="e5-knob" class="absolute top-1 w-4 h-4 bg-white rounded-full transition-all left-7"></div>
                            </button>
                        </div>
                        <h3 class="font-bold mb-1">M365 E5 Security Grant</h3>
                        <p class="text-xs text-slate-500 leading-relaxed">Includes 5MB/user/day for eligible security logs.</p>
                        <div id="e5-stats" class="mt-4 pt-4 border-t border-indigo-500/20">
                            <div class="text-xs font-bold text-indigo-400 uppercase tracking-tighter">Monthly Grant</div>
                            <div id="e5-grant-val" class="text-xl font-mono font-bold text-white">0 GB</div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="bg-slate-900/50 border border-slate-800 rounded-3xl p-8">
                <div class="flex items-center gap-3 mb-8">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-500"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
                    <h2 class="text-xl font-bold">Infrastructure Workloads</h2>
                </div>
                <div id="infra-inputs" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- JS will inject infrastructure inputs -->
                </div>
            </section>

            <div class="flex justify-end">
                <button onclick="switchStep(1)" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-blue-600/20 flex items-center gap-2 group">
                    Continue to Sources
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:translate-x-1 transition-transform"><path d="m9 18 6-6-6-6"/></svg>
                </button>
            </div>
        </div>

        <!-- STEP 1: SOURCES -->
        <div id="step-1" class="step-content step-hidden space-y-8 animate-fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-8">
                    <h2 class="text-2xl font-bold flex items-center gap-2 mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>
                        Select Log Connectors
                    </h2>
                    <div id="sources-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- JS will inject source cards -->
                    </div>
                </div>

                <div class="lg:col-span-4">
                    <div class="sticky top-28 bg-slate-900 border border-slate-800 rounded-3xl p-6 space-y-6">
                        <h3 class="font-bold text-lg">Strategy Summary</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-end border-b border-slate-800 pb-4">
                                <span class="text-sm text-slate-400">Monthly Volume</span>
                                <span id="summary-gross" class="text-xl font-mono font-bold">0.0 GB</span>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-xs text-slate-500">
                                    <span>Free Platform Logs</span>
                                    <span id="summary-free" class="text-emerald-400">-0.0 GB</span>
                                </div>
                                <div class="flex justify-between text-xs text-slate-500">
                                    <span>E5 Security Grant</span>
                                    <span id="summary-grant" class="text-indigo-400">-0.0 GB</span>
                                </div>
                            </div>
                            <div class="pt-4 mt-4 border-t border-slate-800">
                                <div class="flex justify-between items-center mb-6">
                                    <span class="font-bold text-slate-100">Billable Daily</span>
                                    <span id="summary-billable" class="text-2xl font-mono font-bold text-blue-400">0.00 GB</span>
                                </div>
                                <button onclick="switchStep(2)" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2 transition-all shadow-xl shadow-blue-500/20">
                                    Analyze Final Costs
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STEP 2: COSTS -->
        <div id="step-2" class="step-content step-hidden space-y-8 animate-fade-in max-w-4xl mx-auto">
            <div class="bg-gradient-to-br from-blue-900/40 to-slate-900 border border-blue-500/30 rounded-[3rem] p-10 md:p-16 text-center shadow-2xl relative overflow-hidden">
                <div class="relative z-10">
                    <div class="text-blue-400 text-xs font-bold uppercase tracking-[0.3em] mb-4">Final Cost Strategy</div>
                    <h2 class="text-6xl md:text-8xl font-black text-white tracking-tighter mb-4">
                        <span class="text-4xl align-top mr-1 font-bold opacity-40">$</span>
                        <span id="final-cost">0</span>
                    </h2>
                    <div class="text-slate-400 font-medium text-lg">Per Month in <span id="final-region" class="text-blue-100">East US</span></div>
                    
                    <div class="mt-12 inline-flex flex-wrap justify-center gap-3">
                        <div class="bg-white/5 border border-white/10 px-5 py-2 rounded-full text-sm font-bold flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-emerald-400"><path d="m3 16 2 2 2-2"/><path d="M7 18V4"/><path d="m21 8-2-2-2 2"/><path d="M17 6v14"/></svg>
                            Tier: <span id="final-tier">PAYG</span>
                        </div>
                        <div class="bg-white/5 border border-white/10 px-5 py-2 rounded-full text-sm font-bold flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-400"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>
                            <span id="final-billable">0.0</span> GB Billable
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-slate-900 border border-slate-800 p-8 rounded-3xl">
                    <h4 class="text-xs font-bold text-slate-500 uppercase mb-4 tracking-widest">Commitment Savings</h4>
                    <div id="savings-val" class="text-3xl font-bold text-emerald-400 mb-1">$0</div>
                    <p class="text-xs text-slate-500">Relative to PAYG.</p>
                </div>
                <div class="bg-slate-900 border border-slate-800 p-8 rounded-3xl">
                    <h4 class="text-xs font-bold text-slate-500 uppercase mb-4 tracking-widest">Region Modifier</h4>
                    <div id="multiplier-val" class="text-3xl font-bold text-white mb-1">x1.00</div>
                    <p class="text-xs text-slate-500">Regional price uplift.</p>
                </div>
                <div class="bg-slate-900 border border-slate-800 p-8 rounded-3xl">
                    <h4 class="text-xs font-bold text-slate-500 uppercase mb-4 tracking-widest">Free Allowance</h4>
                    <div id="allowance-val" class="text-3xl font-bold text-indigo-400 mb-1">0.0 GB</div>
                    <p class="text-xs text-slate-500">Total monthly deductions.</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="mt-20 py-12 px-6 border-t border-slate-900 bg-slate-950">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8 opacity-40 grayscale hover:grayscale-0 hover:opacity-100 transition-all duration-700">
           <div class="flex items-center gap-2">
             <span class="font-bold text-sm tracking-tighter uppercase">Sentinel Strategy Engine</span>
           </div>
           <p class="text-xs text-center md:text-left max-w-md">Modeling tool for Microsoft Sentinel planning. Actual costs depend on EA agreements and specific data types.</p>
           <div class="text-[10px] uppercase font-bold tracking-widest">Â© 2026 LockBase Logic Framework</div>
        </div>
    </footer>

    <script>
        // DATA
        const REGIONS = [
            { id: 'eastus', name: 'East US', multiplier: 1.0, label: 'Baseline' },
            { id: 'eastus2', name: 'East US 2', multiplier: 1.11, label: '+11%' },
            { id: 'centralus', name: 'Central US', multiplier: 1.05, label: '+5%' },
            { id: 'westus', name: 'West US', multiplier: 1.30, label: '+30%' },
            { id: 'northeurope', name: 'North Europe', multiplier: 1.15, label: '+15%' },
            { id: 'uksouth', name: 'UK South', multiplier: 1.18, label: '+18%' },
            { id: 'brazilsouth', name: 'Brazil South', multiplier: 1.40, label: '+40%' },
            { id: 'japaneast', name: 'Japan East', multiplier: 1.25, label: '+25%' },
        ];

        const LOG_SOURCES = [
            { id: 'azure_act', name: 'Azure Activity Log', type: 'Platform', free: true, baseVol: 0.05 },
            { id: 'dfc', name: 'Defender for Cloud', type: 'Security', free: true, baseVol: 0.02 },
            { id: 'o365', name: 'Office 365 Management', type: 'SaaS', free: true, baseVol: 0.1 },
            { id: 'entra', name: 'Microsoft Entra ID', type: 'Identity', free: false, scalesWith: 'users', multiplier: 0.002 },
            { id: 'win_sec', name: 'Windows Security Events', type: 'Endpoint', free: false, scalesWith: 'servers', multiplier: 0.5 },
            { id: 'syslog', name: 'Linux Syslog', type: 'Endpoint', free: false, scalesWith: 'servers', multiplier: 0.3 },
            { id: 'fw', name: 'Firewall (Palo/Forti)', type: 'Network', free: false, scalesWith: 'networkAssets', multiplier: 0.05 },
            { id: 'nsg_flow', name: 'Azure NSG Flow Logs', type: 'Network', free: false, scalesWith: 'nsgs', multiplier: 1.5 },
            { id: 'vnet_flow', name: 'Azure VNet Flow Logs', type: 'Network', free: false, scalesWith: 'vnets', multiplier: 3.0 },
            { id: 'aws', name: 'AWS CloudTrail', type: 'Cloud', free: false, scalesWith: 'awsAccounts', multiplier: 0.2 },
            { id: 'k8s', name: 'Kubernetes Nodes', type: 'Container', free: false, scalesWith: 'k8sNodes', multiplier: 1.0 },
        ];

        const COMMITMENT_TIERS = [
            { minGB: 0, label: "PAYG", baseDaily: 0 },
            { minGB: 50, label: "50 GB/day", baseDaily: 161 },
            { minGB: 100, label: "100 GB/day", baseDaily: 296 },
            { minGB: 200, label: "200 GB/day", baseDaily: 548 },
            { minGB: 300, label: "300 GB/day", baseDaily: 800 },
            { minGB: 400, label: "400 GB/day", baseDaily: 1037 },
            { minGB: 500, label: "500 GB/day", baseDaily: 1265 },
        ];

        // STATE
        let state = {
            activeStep: 0,
            regionId: 'eastus',
            users: 250,
            endpoints: 250,
            servers: 20,
            networkAssets: 100,
            awsAccounts: 0,
            nsgs: 0,
            vnets: 0,
            k8sNodes: 0,
            hasE5Grant: true,
            selectedSources: ['azure_act', 'dfc', 'o365', 'entra']
        };

        // CORE LOGIC
        function calculate() {
            const region = REGIONS.find(r => r.id === state.regionId);
            let totalDaily = 0;
            let freeDaily = 0;

            state.selectedSources.forEach(sid => {
                const src = LOG_SOURCES.find(s => s.id === sid);
                if (!src) return;
                let vol = src.scalesWith ? (state[src.scalesWith] * src.multiplier) : src.baseVol;
                totalDaily += vol;
                if (src.free) freeDaily += vol;
            });

            const e5Grant = state.hasE5Grant ? (state.users * 0.005) : 0;
            const billableDaily = Math.max(0, totalDaily - freeDaily - e5Grant);

            // Cost optimization
            const paygRate = 4.30 * region.multiplier;
            let bestMonthly = billableDaily * paygRate * 31;
            let bestTier = "Pay-As-You-Go";

            COMMITMENT_TIERS.forEach(tier => {
                if (tier.minGB === 0) return;
                const tierDaily = (tier.baseDaily * region.multiplier) + (Math.max(0, billableDaily - tier.minGB) * (tier.baseDaily / tier.minGB) * region.multiplier);
                const tierMonthly = tierDaily * 31;
                if (tierMonthly < bestMonthly) {
                    bestMonthly = tierMonthly;
                    bestTier = tier.label;
                }
            });

            return {
                totalDaily,
                freeDaily,
                e5Grant,
                billableDaily,
                bestTier,
                bestMonthly,
                region,
                savings: (billableDaily * paygRate * 31) - bestMonthly
            };
        }

        // DOM UPDATES
        function render() {
            const results = calculate();

            // Header Stats
            document.getElementById('stat-daily').innerHTML = `${results.totalDaily.toFixed(2)} <span class="text-xs text-slate-600">GB</span>`;
            document.getElementById('stat-cost').innerText = `$${Math.round(results.bestMonthly).toLocaleString()}`;
            document.getElementById('source-count-badge').innerText = state.selectedSources.length;

            // Step Visibility
            document.querySelectorAll('.step-content').forEach((el, idx) => {
                el.classList.toggle('step-hidden', idx !== state.activeStep);
            });

            // Nav Highlighting
            document.querySelectorAll('.nav-btn').forEach((btn, idx) => {
                if (idx === state.activeStep) {
                    btn.className = "nav-btn flex items-center gap-2 px-4 py-2 rounded-lg transition-all border bg-blue-600 text-white border-blue-500 shadow-lg shadow-blue-500/20";
                } else {
                    btn.className = "nav-btn flex items-center gap-2 px-4 py-2 rounded-lg transition-all border bg-slate-800 text-slate-400 border-slate-700 hover:text-white";
                }
            });

            // Step 0 - Regions
            const regSel = document.getElementById('region-selector');
            if (regSel.children.length === 0) {
                REGIONS.forEach(r => {
                    const btn = document.createElement('button');
                    btn.id = `reg-btn-${r.id}`;
                    btn.onclick = () => { state.regionId = r.id; render(); };
                    btn.className = "flex items-center justify-between p-3 rounded-xl border transition-all";
                    btn.innerHTML = `<span class="text-sm font-medium">${r.name}</span><span class="text-[10px] font-bold opacity-60 uppercase">${r.label}</span>`;
                    regSel.appendChild(btn);
                });
            }
            REGIONS.forEach(r => {
                const btn = document.getElementById(`reg-btn-${r.id}`);
                btn.className = (state.regionId === r.id) 
                    ? "flex items-center justify-between p-3 rounded-xl border transition-all bg-blue-600/10 border-blue-500 text-blue-100"
                    : "flex items-center justify-between p-3 rounded-xl border transition-all bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-500";
            });

            // Step 0 - E5 UI
            document.getElementById('e5-toggle').className = state.hasE5Grant ? "w-12 h-6 rounded-full relative transition-all bg-indigo-500" : "w-12 h-6 rounded-full relative transition-all bg-slate-700";
            document.getElementById('e5-knob').className = state.hasE5Grant ? "absolute top-1 w-4 h-4 bg-white rounded-full transition-all left-7" : "absolute top-1 w-4 h-4 bg-white rounded-full transition-all left-1";
            document.getElementById('e5-card').className = state.hasE5Grant ? "p-6 rounded-3xl border transition-all bg-indigo-600/10 border-indigo-500/50" : "p-6 rounded-3xl border transition-all bg-slate-900 border-slate-800 opacity-60";
            document.getElementById('e5-grant-val').innerText = `${(results.e5Grant * 31).toFixed(1)} GB`;

            // Step 1 - Sources Grid
            const grid = document.getElementById('sources-grid');
            if (grid.children.length === 0) {
                LOG_SOURCES.forEach(s => {
                    const btn = document.createElement('button');
                    btn.id = `src-btn-${s.id}`;
                    btn.onclick = () => toggleSource(s.id);
                    grid.appendChild(btn);
                });
            }
            LOG_SOURCES.forEach(s => {
                const btn = document.getElementById(`src-btn-${s.id}`);
                const isSel = state.selectedSources.includes(s.id);
                const vol = s.scalesWith ? (state[s.scalesWith] * s.multiplier) : s.baseVol;
                btn.className = isSel 
                    ? "text-left p-5 rounded-3xl border transition-all bg-blue-600/10 border-blue-500/50 shadow-md relative"
                    : "text-left p-5 rounded-3xl border transition-all bg-slate-900 border-slate-800 hover:border-slate-600 relative opacity-80";
                btn.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[10px] font-bold text-slate-500 uppercase">${s.type}</span>
                        <span class="text-[10px] font-bold uppercase ${s.free ? 'text-emerald-400' : 'text-blue-400'}">${s.free ? 'Free' : 'Paid'}</span>
                    </div>
                    <h4 class="font-bold text-slate-100 mb-1">${s.name}</h4>
                    <div class="text-xs text-slate-500">~${vol.toFixed(2)} GB/day</div>
                `;
            });

            // Step 1 - Summary Sidebar
            document.getElementById('summary-gross').innerText = `${(results.totalDaily * 31).toFixed(1)} GB`;
            document.getElementById('summary-free').innerText = `-${(results.freeDaily * 31).toFixed(1)} GB`;
            document.getElementById('summary-grant').innerText = `-${(results.e5Grant * 31).toFixed(1)} GB`;
            document.getElementById('summary-billable').innerText = `${results.billableDaily.toFixed(2)} GB`;

            // Step 2 - Final Results
            document.getElementById('final-cost').innerText = Math.round(results.bestMonthly).toLocaleString();
            document.getElementById('final-region').innerText = results.region.name;
            document.getElementById('final-tier').innerText = results.bestTier;
            document.getElementById('final-billable').innerText = results.billableDaily.toFixed(1);
            document.getElementById('savings-val').innerText = `$${Math.round(results.savings).toLocaleString()}`;
            document.getElementById('multiplier-val').innerText = `x${results.region.multiplier.toFixed(2)}`;
            document.getElementById('allowance-val').innerText = `${((results.freeDaily + results.e5Grant) * 31).toFixed(1)} GB`;
        }

        // ACTIONS
        function updateState(key, val) {
            state[key] = Math.max(0, parseInt(val) || 0);
            render();
        }

        function toggleE5() {
            state.hasE5Grant = !state.hasE5Grant;
            render();
        }

        function toggleSource(id) {
            if (state.selectedSources.includes(id)) {
                state.selectedSources = state.selectedSources.filter(x => x !== id);
            } else {
                state.selectedSources.push(id);
            }
            render();
        }

        function switchStep(idx) {
            state.activeStep = idx;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            render();
        }

        // INITIALIZATION
        function init() {
            // Build infra inputs
            const infraContainer = document.getElementById('infra-inputs');
            const fields = [
                { k: 'servers', l: 'Servers (On-Prem/VM)' },
                { k: 'networkAssets', l: 'Network Assets' },
                { k: 'awsAccounts', l: 'AWS Accounts' },
                { k: 'nsgs', l: 'Azure NSGs' },
                { k: 'vnets', l: 'Azure VNets' },
                { k: 'k8sNodes', l: 'K8s Nodes' }
            ];
            fields.forEach(f => {
                const div = document.createElement('div');
                div.className = "bg-slate-800/40 border border-slate-700/50 p-4 rounded-2xl";
                div.innerHTML = `
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-tighter block mb-2">${f.l}</label>
                    <input type="number" value="${state[f.k]}" oninput="updateState('${f.k}', this.value)" class="w-full bg-slate-900 border border-slate-700 rounded-lg py-2 px-3 text-sm focus:ring-1 focus:ring-blue-500 outline-none font-mono">
                `;
                infraContainer.appendChild(div);
            });
            render();
        }

        window.onload = init;
    </script>
</body>
</html>

